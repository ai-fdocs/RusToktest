# Admin Migration Checklist (Legacy Next.js → Leptos)

## Контекст и источники

Этот чеклист собран по двум источникам:

1. Матрица текущего статуса Admin в `docs/UI/developer-storefront-plan.md` (колонки Leptos/Next для Phases 1–3).
2. Фактически реализованные маршруты/экраны Leptos-админки в `apps/admin/src`.

> В репозитории нет исходников legacy Next.js админки как отдельного приложения; ниже "legacy" понимается зафиксированная функциональность из планов/матриц.

## Статусы

- **Реализовано** — сценарий полностью присутствует в Leptos-админке.
- **Частично** — присутствует только часть поведения (например, чтение без изменения, backend есть, но UI не подключен).
- **Отсутствует** — в Leptos-админке сценарий не найден.

---

## P0 — Критичные сценарии миграции

### 1) Доступ и безопасность

| Сценарий legacy Next.js админки | Категория | Leptos статус | Примечание |
|---|---|---|---|
| Логин (tenant slug + email + password) | Доступ | **Реализовано** | Есть отдельный `/login`, auth bootstrap и protected routes. |
| Регистрация | Доступ | **Реализовано** | Есть `/register`. |
| Сброс пароля (запрос + подтверждение) | Доступ | **Реализовано** | Есть `/reset` и API вызовы. |
| Guard приватных роутов | Права доступа | **Реализовано** | `ProtectedRoute` блокирует неавторизованный доступ. |
| Ролевое разграничение внутри UI (admin/moderator/viewer) | Права доступа | **Отсутствует** | Сейчас guard проверяет только факт токена, без route-level RBAC. |

### 2) Пользователи: раздел и операции

| Сценарий legacy Next.js админки | Категория | Leptos статус | Примечание |
|---|---|---|---|
| Раздел Users (список) | Разделы | **Реализовано** | Есть `/users` со списком из GraphQL. |
| Просмотр карточки пользователя | Разделы / CRUD (Read) | **Реализовано** | Есть `/users/:id`. |
| Users CRUD: Create | CRUD | **Отсутствует** | В UI нет формы/мутации создания. |
| Users CRUD: Update | CRUD | **Отсутствует** | В UI нет формы/мутации обновления пользователя. |
| Users CRUD: Disable | CRUD | **Отсутствует** | В UI нет действия disable пользователя. |
| Фильтр по тексту (search) | Фильтры | **Реализовано** | Поиск по имени/email, синхронизация с URL. |
| Фильтр по роли | Фильтры | **Реализовано** | Клиентская фильтрация + URL sync. |
| Фильтр по статусу | Фильтры | **Реализовано** | Клиентская фильтрация + URL sync. |
| Массовые действия (bulk disable/assign role) | Массовые действия | **Отсутствует** | Нет мультивыбора/toolbar bulk actions. |
| Экспорт списка пользователей (CSV/JSON) | Экспорт/импорт | **Отсутствует** | Нет UI/API потока экспорта. |
| Импорт пользователей | Экспорт/импорт | **Отсутствует** | Нет UI/API потока импорта. |

### 3) Аудирование и сессии

| Сценарий legacy Next.js админки | Категория | Leptos статус | Примечание |
|---|---|---|---|
| Security page (сессии) | Разделы | **Реализовано** | Есть `/security`. |
| Просмотр активных сессий | Аудирование | **Реализовано** | Есть загрузка `/api/auth/sessions`. |
| Sign out all sessions | Массовые действия | **Реализовано** | Есть `/api/auth/sessions/revoke-all`. |
| История логинов (success/failed) | Аудирование | **Частично** | История есть, но по данным сессий; отдельной классификации failed в UI нет. |
| Общий аудит действий администратора (кто/что изменил) | Аудирование | **Отсутствует** | Отдельного audit log раздела в админке нет. |

---

## P1 — Важные, но не блокирующие запуск

### 4) Профиль и удобство управления

| Сценарий legacy Next.js админки | Категория | Leptos статус | Примечание |
|---|---|---|---|
| Profile page (name/avatar/timezone/language) | Разделы / CRUD | **Частично** | Профиль есть, но покрытие полей зависит от backend API. |
| Смена пароля | CRUD | **Реализовано** | Есть action на `/api/auth/change-password`. |
| Dashboard | Разделы | **Реализовано** | Есть `/dashboard`. |
| Breadcrumbs в shell | UX/навигация | **Отсутствует** | Отмечено как gap в документации. |

---

## Сводка пробелов для миграции

### Наибольшие gaps (в порядке приоритета)

1. **Users write-операции (Create/Update/Disable) в Leptos UI.**
2. **RBAC на уровне интерфейса и маршрутов (не только наличие токена).**
3. **Массовые действия для users (bulk operations).**
4. **Полноценный audit log админских действий.**
5. **Export/Import для админских сущностей (минимум users).**

---

## Definition of Done для отключения legacy-админки

Legacy Next.js админка может быть отключена только при выполнении всех условий:

- [ ] Все сценарии **P0** имеют статус **"Реализовано"** в Leptos-админке.
- [ ] Все сценарии **P1** имеют статус не ниже **"Частично"**, а критичные для операционной работы — **"Реализовано"**.
- [ ] Для каждого P0/P1 сценария выполнен **ручной smoke/UAT** в staging-среде.
- [ ] Зафиксирован и утверждён go-live отчёт по миграции (ссылка на результаты ручного тестирования).

## Критерий отключения legacy-админки (gate)

> **Отключение legacy-админки разрешено только когда все P0/P1 сценарии реализованы и протестированы вручную.**
